<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cart - An's Toy Store</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/style.css">
    <script src="assets/js/site.js"></script>
    <style>
        /* Responsive cart page adjustments */
        @media (max-width: 768px) {
            main { margin-top: 140px !important; }
        }
        @media (max-width: 576px) {
            main { margin-top: 140px !important; }
        }
        
        /* Mobile/Tablet cart card layout */
        @media (max-width: 992px) {
            .cart-table-wrapper {
                display: none;
            }
            .cart-cards-wrapper {
                display: block;
            }
        }
        
        /* Desktop table layout */
        @media (min-width: 993px) {
            .cart-table-wrapper {
                display: block;
            }
            .cart-cards-wrapper {
                display: none;
            }
        }
        
        .cart-item-card {
            background: #f9f9f9;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
            display: flex;
            gap: 12px;
        }
        
        .cart-item-card-image {
            flex-shrink: 0;
            width: 80px;
            height: 80px;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .cart-item-card-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .cart-item-card-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        
        .cart-item-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }
        
        .cart-item-card-name {
            font-weight: 600;
            font-size: 14px;
            flex: 1;
            margin-right: 12px;
        }
        
        .cart-item-card-remove {
            background: none;
            border: none;
            color: #d32f2f;
            cursor: pointer;
            padding: 0;
            font-size: 18px;
        }
        
        .cart-item-card-price {
            color: #d32f2f;
            font-weight: 700;
            font-size: 14px;
            margin-bottom: 8px;
        }
        
        .cart-item-card-controls {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }
        
        .qty-btn-mobile {
            width: 32px;
            height: 32px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }
        
        .qty-input-mobile {
            width: 50px;
            height: 32px;
            border: 1px solid #ddd;
            padding: 4px;
            text-align: center;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .cart-item-card-total {
            font-weight: 600;
            font-size: 14px;
            text-align: right;
        }
    </style>
</head>
<body class="with-sticky-footer">
<header>
    <div class="header-container">
        <div class="logo" id="logo">AN TOY'S STORE</div>
        <div style="flex:1"></div>
        <div class="search-bar">
            <input type="text" id="siteSearchInput" placeholder="Search for products..." autocomplete="off">
            <div id="siteSearchResults" class="search-results" style="display:none;"></div>
        </div>
        <button class="hamburger-menu">
            <span></span>
            <span></span>
            <span></span>
        </button>
        <nav>
            <ul>
                <li><a href="Trangchu_en.html">Home</a></li>
                <li><a href="TatcaSanpham_en.html">Products</a></li>
                <li><a href="Gioithieu_en.html">About</a></li>
            </ul>
        </nav>
        <div class="language-selector">
            <select id="languageSelect">
                <option value="vi">Ti·∫øng Vi·ªát</option>
                <option value="en" selected>English</option>
            </select>
        </div>
        <div class="auth-wrap">
            <div class="auth-icon" id="authIcon"></div>
            <div class="auth-popup" id="authPopup"></div>
        </div>
        <div class="cart-icon" id="cartIcon">üõí</div>
    </div>
</header>

<main style="max-width:1100px;margin:100px auto;padding:0 1rem;">
    <div class="page-grid">
        <div class="page-main">
            <h1>Your Cart</h1>
            <div id="cartArea">Loading...</div>
        </div>
        <aside class="page-aside">
            <div class="summary-card" id="cartSummary">
                <div class="summary-title">Total</div>
                <div class="summary-amount">$0</div>
                <div class="summary-actions"><button class="btn btn-primary" id="checkoutBtn">Purchases (0)</button></div>
            </div>
        </aside>
    </div>
</main>

<footer>
    <div class="footer-content">
        <div class="footer-section">
            <h4>About An's Toys Store</h4>
            <ul>
                <li><a href="Gioithieu_en.html">Introduction</a></li>
                <li><a href="#">Policies</a></li>
            </ul>
        </div>
        <div class="footer-section">
            <h4>Support</h4>
            <ul>
                <li><a href="#">Shopping Guide</a></li>
                <li><a href="#">Returns</a></li>
                <li><a href="#">Contact</a></li>
            </ul>
        </div>
        <div class="footer-section">
            <h4>Follow Us</h4>
            <ul>
                <li><a href="#">Facebook</a></li>
                <li><a href="#">Instagram</a></li>
                <li><a href="#">TikTok</a></li>
            </ul>
        </div>
    </div>
</footer>

<script>
function renderCart() {
    var cart = (window.SITE && SITE.getCart) ? SITE.getCart() : (JSON.parse(localStorage.getItem('cartItems')||'[]'));
    var out = '';
    var summary = '';
    if (!cart || cart.length === 0) {
        out = '<div class="empty-card"><p style="text-align:center;padding:48px 16px">Your cart is empty. <a href="TatcaSanpham_en.html">Shop now</a></p></div>';
        document.getElementById('cartArea').innerHTML = out;
        // update summary
        document.getElementById('cartSummary').querySelector('.summary-amount').textContent = '$0';
        document.getElementById('cartSummary').querySelector('#checkoutBtn').textContent = 'Purchases (0)';
        return;
    }
    
    var total = 0;
    
    // Desktop table layout
    var tableOut = '<div class="cart-table-wrapper"><div class="cart-card"><table style="width:100%;border-collapse:collapse;"><thead><tr><th style="text-align:left;padding:12px">Product</th><th style="padding:12px">Price</th><th style="padding:12px">Quantity</th><th style="padding:12px">Total</th><th></th></tr></thead><tbody>';
    
    // Mobile/Tablet card layout
    var cardsOut = '<div class="cart-cards-wrapper">';
    
    cart.forEach(function(it,idx){
        var qty = it.qty || it.quantity || 1;
        var line = (it.price || 0) * qty;
        total += line;
        
        // Table row for desktop
        tableOut += '<tr data-idx="'+idx+'">'
            + '<td style="padding:12px;vertical-align:middle;">'
            + '<div style="display:flex;flex-direction:column;align-items:flex-start;">'
            + '<strong style="margin-bottom:8px;">'+it.name+'</strong>'
            + (it.img? '<img src="'+it.img+'" style="width:64px;height:64px;object-fit:cover;">':'')
            + '</div>'
            + '</td>'
            + '<td style="padding:12px;vertical-align:middle;">'+((it.price||0)/26306).toFixed(2)+'$</td>'
            + '<td style="padding:12px;vertical-align:middle;text-align:center;">'
            + '<div style="display:flex;align-items:center;justify-content:center;gap:8px;">'
            + '<button onclick="changeQty('+idx+', -1)" class="qty-btn" style="padding:8px 12px;min-width:44px;min-height:44px;">-</button>'
            + '<input type="number" id="qty_'+idx+'" value="'+qty+'" min="1" class="qty-input" style="width:60px;padding:8px;text-align:center;font-size:1rem;min-height:44px;">'
            + '<button onclick="changeQty('+idx+', 1)" class="qty-btn" style="padding:8px 12px;min-width:44px;min-height:44px;">+</button>'
            + '</div>'
            + '</td>'
            + '<td style="padding:12px;vertical-align:middle;">'+(line/26306).toFixed(2)+'$</td>'
            + '<td style="padding:12px;vertical-align:middle;"><button onclick="removeItem('+idx+')" class="btn btn-danger">X√≥a</button></td>'
            + '</tr>';
        
        // Card for mobile/tablet
        cardsOut += '<div class="cart-item-card">'
            + '<div class="cart-item-card-image">'
            + (it.img? '<img src="'+it.img+'" alt="'+it.name+'">':'')
            + '</div>'
            + '<div class="cart-item-card-content">'
            + '<div class="cart-item-card-header">'
            + '<div class="cart-item-card-name">'+it.name+'</div>'
            + '<button onclick="removeItem('+idx+')" class="cart-item-card-remove">üóëÔ∏è</button>'
            + '</div>'
            + '<div class="cart-item-card-price">$'+((it.price||0)/26306).toFixed(2)+'</div>'
            + '<div class="cart-item-card-controls">'
            + '<button onclick="changeQty('+idx+', -1)" class="qty-btn-mobile">‚àí</button>'
            + '<input type="number" id="qty_'+idx+'" value="'+qty+'" min="1" class="qty-input-mobile">'
            + '<button onclick="changeQty('+idx+', 1)" class="qty-btn-mobile">+</button>'
            + '</div>'
            + '<div class="cart-item-card-total">Total: $'+(line/26306).toFixed(2)+'</div>'
            + '</div>'
            + '</div>';
    });
    
    tableOut += '</tbody></table></div></div>';
    cardsOut += '</div>';
    
    document.getElementById('cartArea').innerHTML = tableOut + cardsOut;
    
    // update summary card
    var sumEl = document.getElementById('cartSummary');
    if (sumEl) {
        sumEl.querySelector('.summary-amount').textContent = '$' + (total/26306).toFixed(2);
        var btn = sumEl.querySelector('#checkoutBtn');
        if (btn) btn.textContent = 'Purchases ('+cart.length+')';
        // wire checkout button
        btn.onclick = function(){ localStorage.setItem('checkoutCart', JSON.stringify(cart)); window.location.href = 'ThanhToan_en.html'; };
    }
}

function changeQty(idx, delta){
    var cart = (window.SITE && SITE.getCart) ? SITE.getCart() : JSON.parse(localStorage.getItem('cartItems')||'[]');
    if (!cart[idx]) return; 
    var input = document.getElementById('qty_'+idx);
    var val = parseInt(input.value)||1;
    val = Math.max(1, val + delta);
    input.value = val;
    cart[idx].qty = val; cart[idx].quantity = val;
    if (window.SITE && SITE.setCart) SITE.setCart(cart); else localStorage.setItem('cartItems', JSON.stringify(cart));
    if (window.SITE && SITE.recalcCartCount) SITE.recalcCartCount();
    renderCart();
}

function removeItem(idx){
    var cart = (window.SITE && SITE.getCart) ? SITE.getCart() : JSON.parse(localStorage.getItem('cartItems')||'[]');
    cart.splice(idx,1);
    if (window.SITE && SITE.setCart) SITE.setCart(cart); else localStorage.setItem('cartItems', JSON.stringify(cart));
    if (window.SITE && SITE.recalcCartCount) SITE.recalcCartCount();
    renderCart();
}

function proceedCheckout(){
    var cart = (window.SITE && SITE.getCart) ? SITE.getCart() : JSON.parse(localStorage.getItem('cartItems')||'[]');
    if (!cart || cart.length===0) return alert('Cart is empty');
    localStorage.setItem('checkoutCart', JSON.stringify(cart));
    window.location.href = 'ThanhToan.html';
}

// initialize
document.addEventListener('DOMContentLoaded', function(){
    if (window.SITE && SITE.recalcCartCount) SITE.recalcCartCount();
    renderCart();
});
</script>

<script>
// Header behaviors: cart count, search, logo and nav wiring
document.addEventListener('DOMContentLoaded', function(){
    var cartIcon = document.getElementById('cartIcon');
    if (window.SITE && SITE.recalcCartCount) SITE.recalcCartCount();
    if (cartIcon) cartIcon.addEventListener('click', function(){ window.location.href = 'Giohangf.html'; });
    var logo = document.getElementById('logo'); if (logo) logo.addEventListener('click', function(){ window.location.href = 'Trangchu.html'; });

    // search
    var searchInput = document.getElementById('siteSearchInput');
    var searchResults = document.getElementById('siteSearchResults');
    function renderSearchResults(results) {
        if (!searchResults) return;
        if (results.length === 0 || !searchInput.value.trim()) { searchResults.style.display = 'none'; searchResults.innerHTML = ''; return; }
        searchResults.innerHTML = results.map(function(p, idx){ return '<div class="search-result-item" data-idx="'+idx+'"><img src="'+p.img+'" style="width:32px;height:32px;object-fit:cover;margin-right:8px;vertical-align:middle">'+p.name+'<span style="float:right;color:#007bff;font-weight:700">$'+((p.price/26306).toFixed(2))+'</span></div>'; }).join('');
        searchResults.style.display = 'block';
    }
    if (searchInput) {
        searchInput.addEventListener('input', function(){ var val = searchInput.value.trim().toLowerCase(); var products = window.SITE && SITE.demoProducts ? SITE.demoProducts : []; var results = products.filter(function(p){ return p.name.toLowerCase().includes(val); }); renderSearchResults(results); });
        document.addEventListener('click', function(e){ if (!searchResults.contains(e.target) && e.target !== searchInput) { searchResults.style.display='none'; } });
        searchResults.addEventListener('click', function(e){ var item = e.target.closest('.search-result-item'); if (item) { var idx = parseInt(item.getAttribute('data-idx')); var products = window.SITE && SITE.demoProducts ? SITE.demoProducts : []; var product = products[idx]; if (product) { localStorage.setItem('currentProduct', JSON.stringify(product)); window.location.href='TheSanpham_en.html'; } } });
    }
    var allProductsMenu = document.querySelector('nav ul li a[href="TatcaSanpham_en.html"]'); if (allProductsMenu) allProductsMenu.onclick = function(e){ e.preventDefault(); window.location.href='TatcaSanpham_en.html'; };

    var languageSelect = document.getElementById('languageSelect');
    if (languageSelect) {
        languageSelect.addEventListener('change', function() {
            var lang = this.value;
            localStorage.setItem('language', lang);
            if (lang === 'en') {
                window.location.href = 'Giohangf_en.html';
            } else {
                window.location.href = 'Giohangf.html';
            }
        });
    }

    // Check stored language and redirect if necessary
    var storedLang = localStorage.getItem('language');
    if (storedLang === 'vi') {
        window.location.href = 'Giohangf.html';
    }
});
</script>
<script src="assets/js/hamburger.js"></script>

</body>
</html>